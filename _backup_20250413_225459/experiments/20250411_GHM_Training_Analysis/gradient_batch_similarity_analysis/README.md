# 梯度批次相似度分析

本資料夾包含了 GHM 實驗過程中不同訓練階段的梯度批次相似度分析結果。這些分析有助於理解模型訓練過程中梯度方向的一致性和變化情況，進一步佐證 GHM 梯度調整的有效性。

## 文檔

- [梯度批次相似度視覺化指南](visualization_guide.md) - 按時間順序排列的詳細視覺化分析

## 分析圖表說明

本分析包含兩類圖表：

1. **梯度相似度矩陣** (`gradient_similarities_epoch_XX.png`)：
   - 顯示同一批次內不同樣本間梯度方向的餘弦相似度
   - 熱力圖顏色越亮，表示梯度方向越相似
   - 對角線恆為 1（自身相似度）

2. **梯度方向 t-SNE 視覺化** (`gradient_directions_tsne_epoch_XX.png`)：
   - 使用 t-SNE 將高維梯度向量投影到二維平面
   - 每個點代表一個樣本的梯度方向
   - 點的聚集表示梯度方向相似

## 訓練發展趨勢分析

### 早期階段 (第 5-15 輪)
- 梯度方向較為分散，相似度較低
- t-SNE 視覺化中的點分布較為隨機
- 表明模型仍在探索階段，不同樣本梯度方向差異大

### 中期階段 (第 20-40 輪)
- 梯度相似度開始增加，形成一定的模式區塊
- t-SNE 視覺化開始呈現聚類現象
- 表明模型開始形成對某些特徵的一致學習

### 後期階段 (第 45-60 輪)
- 梯度相似度矩陣顯示明確的結構性模式
- t-SNE 視覺化中點的分布更有組織性
- 表明模型對不同類型樣本形成了穩定的梯度方向

## 與 GHM 相關性分析

梯度批次相似度分析與 GHM 優化機制緊密相關：

1. **梯度一致性提升**：
   - GHM 通過重新加權樣本，使得梯度方向逐漸趨於一致
   - 後期階段的高相似度區塊表明 GHM 成功引導模型關注相似特徵

2. **難易樣本分離**：
   - t-SNE 視覺化中的不同聚類對應不同難度的樣本
   - 隨著訓練進行，這種分離更為明顯，反映 GHM 對不同難度樣本的差異化處理

3. **訓練穩定性**：
   - 相似度模式的逐漸穩定表明 GHM 提供了更穩定的訓練過程
   - 後期階段的相似度變化較小，表明模型收斂到相對穩定的狀態

## 關鍵觀察

1. **相似度增強期**：在 25-35 輪之間，梯度相似度顯著增加，這與 GHM 訓練報告中提到的模型性能提升期相一致。

2. **聚類形成**：t-SNE 視覺化顯示，隨著訓練進行，梯度方向逐漸形成 2-3 個主要聚類，可能對應不同難度的樣本組。

3. **穩定收斂**：45 輪之後，梯度相似度模式變化減緩，表明模型在 GHM 幫助下達到相對穩定狀態。

## 結論

梯度批次相似度分析證實了 GHM 在訓練過程中的有效性：

1. GHM 成功引導模型形成對不同難度樣本的差異化但一致的學習方向
2. 訓練過程中梯度相似度的結構化變化反映了 GHM 的梯度調整作用
3. 後期階段的梯度穩定性與 GHM 報告中提到的模型性能穩定相符

這些觀察進一步支持了 GHM 在處理不平衡數據和優化訓練過程方面的優勢。 