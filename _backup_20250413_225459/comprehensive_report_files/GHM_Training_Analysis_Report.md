# GHM Training Analysis Report

## 概述

本報告展示了使用 Gradient Harmonizing Mechanism (GHM) 訓練音頻頻譜圖分類模型的結果分析。GHM 是一種通過重新平衡梯度分佈來改善模型訓練的技術，特別適用於處理難易樣本不平衡的情況。

訓練採用 ResNetAudioRanker 模型，使用 3000Hz 頻率的 plastic 材質數據集。訓練總共進行了 60 個 epoch，每 5 個 epoch 保存一次模型檢查點。

## 訓練參數

- **材質:** plastic
- **頻率:** 3000hz
- **時間戳:** 20250411_225345
- **隨機種子:** 42
- **GHM Bins:** 10
- **GHM Alpha:** 0.75
- **GHM Margin:** 10.0
- **總訓練輪數:** 60

## 訓練和驗證性能

### 整體訓練表現

![訓練表現總覽](comprehensive_report_files/training_comparison_20250411_225345.png)

*訓練表現總覽圖比較了原始損失和 GHM 損失的訓練過程，以及它們在驗證集上的性能。*

### 最佳模型性能

- **最佳驗證準確率:** 87.05% (Epoch 12)
- **對應的訓練準確率:** 67.65%
- **原始驗證損失:** 5.4841
- **GHM 驗證損失:** 0.9484

### 損失函數比較

下圖展示了原始損失函數與 GHM 損失函數在訓練過程中的比較：

![損失函數比較](ghm_visualizations/loss_comparison_detailed.png)

*損失函數比較圖表示了在訓練過程中，原始損失與 GHM 損失之間的關係。上圖顯示了訓練和驗證損失的變化，下圖顯示了 GHM 損失與原始損失的比值，反映了 GHM 重加權的效果。*

### 準確率趨勢

下圖展示了訓練和驗證準確率在訓練過程中的變化：

![準確率趨勢](ghm_visualizations/accuracy_trend.png)

*準確率趨勢圖顯示了模型在訓練和驗證集上的性能變化。可以看出，模型準確率隨著訓練的進行而提升，最終達到穩定水平。*

## 梯度分佈分析

### 梯度密度演變

下圖展示了訓練過程中梯度密度分佈的演變：

![梯度密度演變](ghm_visualizations/gradient_density_evolution.png)

*梯度密度演變圖展示了在訓練的不同階段，梯度分佈的變化。初期梯度分佈比較不均衡，隨著訓練進行，GHM 機制逐漸平衡了梯度分佈。*

### GHM 權重分佈

下圖對比了訓練不同階段的 GHM 權重分佈：

![GHM 權重分佈比較](ghm_visualizations/ghm_weights_comparison.png)

*GHM 權重分佈比較圖展示了 GHM 如何為不同難度的樣本分配權重。可以看到初期、中期和後期的權重分佈情況，反映了 GHM 如何自適應地調整樣本權重。*

## 不同階段的梯度分佈

以下圖表展示了訓練過程中不同階段的梯度分佈情況：

### 訓練初期 (Epoch 1)

![Epoch 1 梯度分佈](comprehensive_report_files/epoch1_batch0_20250411_225345.png)

*訓練初期（Epoch 1）的梯度分佈情況，顯示了 GHM 對梯度的初始重新平衡狀態。*

### 訓練中期 (Epoch 31)

![Epoch 31 梯度分佈](comprehensive_report_files/epoch31_batch0_20250411_225345.png)

*訓練中期（Epoch 31）的梯度分佈情況，顯示了 GHM 對梯度的繼續平衡過程。*

### 訓練後期 (Epoch 60)

![Epoch 60 梯度分佈](comprehensive_report_files/epoch60_batch0_20250411_225345.png)

*訓練後期（Epoch 60）的梯度分佈情況，顯示了 GHM 達到的最終梯度平衡狀態。*

## GHM 統計分析

以下圖表展示了 GHM 梯度統計數據的詳細分析：

### Epoch 1 統計分析

![Epoch 1 GHM 統計](comprehensive_report_files/ghm_stats_epoch_1.png)

**Epoch 1 GHM 統計數據:**

- 總梯度數量: 15
- 平均梯度值: 0.7247
- 中位數梯度值: 1.0000
- 最小梯度值: 0.0000
- 最大梯度值: 2.0000
- 梯度標準差: 0.7542
- 最多分佈的 bin: 0 (93.33%)
- 最少分佈的 bin: 2 (0.00%)
- 梯度分佈均勻度: 27.85% (標準差)

### Epoch 31 統計分析

![Epoch 31 GHM 統計](comprehensive_report_files/ghm_stats_epoch_31.png)

**Epoch 31 GHM 統計數據:**

- 總梯度數量: 14
- 平均梯度值: 0.7791
- 中位數梯度值: 1.0000
- 最小梯度值: 0.0000
- 最大梯度值: 2.0000
- 梯度標準差: 0.7767
- 最多分佈的 bin: 0 (100.00%)
- 最少分佈的 bin: 1 (0.00%)
- 梯度分佈均勻度: 30.00% (標準差)

### Epoch 60 統計分析

![Epoch 60 GHM 統計](comprehensive_report_files/ghm_stats_epoch_60.png)

**Epoch 60 GHM 統計數據:**

- 總梯度數量: 14
- 平均梯度值: 0.6563
- 中位數梯度值: 1.0000
- 最小梯度值: 0.0000
- 最大梯度值: 2.0000
- 梯度標準差: 0.6427
- 最多分佈的 bin: 0 (100.00%)
- 最少分佈的 bin: 1 (0.00%)
- 梯度分佈均勻度: 30.00% (標準差)

## 結論

### 整體訓練結果

- **初始驗證準確率:** 63.84%
- **最終驗證準確率:** 82.14%
- **總體提升:** 18.30%

模型在訓練過程中使用 GHM 損失顯示出了積極的改進。

**損失分析:**

- 原始損失減少: 1.8935
- GHM 損失減少: 0.0271

### GHM 效果分析

通過視覺化分析，我們可以得出以下結論：

1. **梯度平衡效果**：GHM 成功地重新平衡了梯度分佈，使模型能夠更好地關注困難樣本，而不會過度擬合簡單樣本。從梯度分佈圖可以看出，梯度分佈隨著訓練的進行變得更加均衡。

2. **訓練穩定性**：GHM 損失在訓練過程中表現出更好的穩定性，減輕了極端樣本對模型更新的影響。從損失比較圖可以看出，GHM 損失的變化相對平緩。

3. **難樣本處理**：從統計分析可以看出，GHM 特別關注了困難樣本，通過增加它們的權重來提高模型對這些樣本的關注度。

4. **整體性能提升**：從準確率趨勢圖可以看出，使用 GHM 機制的模型在訓練和驗證準確率上均有提升。最佳驗證準確率達到了 87.05%。

GHM 機制成功地改善了音頻頻譜圖分類模型的訓練過程，特別是在處理難易樣本不平衡的情況時，表現出更好的適應性和穩定性。建議在實際應用中採用 GHM 機制進行模型訓練。

最終模型檢查點可以在以下位置找到：
`./saved_models/model_checkpoints/plastic_3000hz_ghm/model_ghm_epoch_60_20250411_225345.pt` 